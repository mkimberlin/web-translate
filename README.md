# web-translate

This is a set of JavaScript functions that support
language translation in web applications.
They are framework-agnostic.

## Setup

To use this package,

1. `npm install web-translate`
2. Add the following npm script in the `package.json` file for your application.\
   `"generate-translations": "node node_modules/web-translate/lib/generate-translations",`

## Supported Languages

Create the file `languages.json` to describe the languages you wish to support.
For example,

```json
{
  "English": "en",
  "French": "fr",
  "Spanish": "es"
}
```

This file must be in a directory that is accessible at the domain of the web app.
For example, if your web app is running on `localhost:3000`
then a GET request to `localhost:3000/language.json`
must return the content of this file.
For a React app created with create-react-app,
placing this file in the `public` directory will achieve this.

## Getting Translations

Use the `i18n` function get translations.
For example, when the language is Spanish
calling `i18n('Hello')` might return "Hola".
The string passed to the `i18n` function can be
English text or a key used to lookup the translation.

Keys are useful for long phrases, sentences, and even paragraphs.
For example, `i18n('greet')` might return
"Welcome to my wonderful web application!".
Translations for keys must be defined in language-specific JSON files.
For example, the file `en.json` could contain the following:

```json
{
  "contact": "For more information, contact Mark Volkmann.",
  "greet": "Welcome to my wonderful web application!"
}
```

## Specifying Translations

Translations of all the text for all supported languages
can be manually entered in language-specific JSON files
like `es.json` (for Spanish) and `fr.json` (for French).
However as we will see next, these files can be generated
using the Google Translate API.
In some cases it may be desirable to use different translations.
Those provided by Google Translate can be overridden by
creating a JSON file whose name starts with the language code,
followed by `-override.json`.
For example, the file `es-overrides.json` could contain
the following to change the translation for "Hello"
from "Hola" to "Oh La".

```json
{
  "Hello": "Oh La"
}
```

## Generating Translations

Manually looking up and specifying translations can be very tedious!
Translations files for all the languages to be supported
can be generated by simply running `npm run generate-translations`.
Here is a description of what this does.

1. Get all the languages to be supported from the file `languages.json`.
2. Get all the strings passed to the `i18n` function
   in all the `.js` files under the `src` directory.
3. Get all the English translations from the file `en.json`.
4. For each language to be supported except English ...
   1. Set `translations` to all the translations found
      in an overrides file for the current language
      (ex. `fr-overrides.json`).
      If none exists then `translations` begins empty.
   2. For each key/value pair in the English translation file `en.json` ...
      - If we do not already have a translation for this key,
        get the translation for the value from Google Translate
        and save it in `translations`.
   3. For each key found in `.js` files ...
      - If we do not already have a translation for this key,
        get the translation for the value from Google Translate
        and save it in `translations`.
   4. Write `translations` to a new translation file for the current language.

## Allowing User to Select Language

It is easy to allow the user to change the current language.
Here is an example of how this can be done in a React application.
It should be somewhat similar for other frameworks.

```js
import {getSupportedLanguages, setLanguage, i18n} from './translate';

class App extends Component {
  state = {languages: {}};

  async componentDidMount() {
    const languages = await getSupportedLanguages();
    this.setState({languages});
  }

  changeLanguage = async event => {
    await setLanguage(event.target.value);
    this.forceUpdate();
  };

  render() {
    const {languages} = this.state;
    const languageNames = Object.keys(languages);

    return (
      <div className="App">
        <div>
          <label>Language:</label>
          <select onChange={this.changeLanguage}>
            {languageNames.map(name => (
              <option key={name} value={languages[name]}>
                {name}
              </option>
            ))}
          </select>
        </div>
        <div>{i18n('Hello')}</div>
        <div>{i18n('some-key')}</div>
        <div>{i18n('I love strawberry pie!')}</div>
      </div>
    );
  }
}

export default App;
```

With watch and live reload (as supported by create-react-app),
changes to the list of supported languages and their translations
are made available in the running app seconds after they are saved.

Run `npm run generate-translations` again whenever

- the list of supported languages in `languages.json` changes
- new translations are added in the English file `en.json`
- a changes is made in a language overrides `.json` file
- a new call to `i18n` is added in `.js` file,
  or the string passed to an existing call is changed,
  and translations for the string passed to it
  are not already present in all the language `.json` files
